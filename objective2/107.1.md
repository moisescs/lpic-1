## 107.1 Manage user and group accounts and related system files

* `UID` e `GUID` não possuem relação direta, os valores podem ser iguais mas é apenas coincidência.

### useradd
* `-m` cria o home com o valor padrão ou personalizado. Sem ele, o home não é criado.
* `-g` define o grupo primário.
* `-G` grupos adicionais serão adicionados ao usuário além do grupo primário.
* `-r` cria um usuário de sistema, normalmente não possui home, não expira.
* `-s` define o shell.

### usermod
* `-l` altera o nome de usuário. **O home deve ser renomeado manualmente**. **O diretório de email é ajustado automaticamente** `/var/spool/mail`.
* `-c` adiciona uma descrição para o usuário em `/etc/passwd`.
* `-d` `--home` define novo home, **não cria o novo diretório**.
* * `-m` `--move-home` usa em conjunto com `-d` para renomer o home atual para o novo nome. **Não pode existir um diretório com o novo nome**.
* `-G` adiciona grupos suplementares ao usuário.
* * `-a` `--append` deve ser passado, senão os grupos existentes serão sobrescritos.
* `-L` bloqueia a senha do usuário, mas permite outras formas de login (ssh key, su - <user>). Insere ! no início do pass do usuário localizado em /etc/shadow.
* `-R` chroot.

```shell
# modifica o login, a1 passa a ser a2
usermod -l a2 a1
# o diretório de email é renomeado automaticamente, MAS o home não
ls /var/spool/mail
ls /home

# modifica o home do usuário, sem levar o conteúdo do antigo
usermod -d /home/a2 a2
usermod --home /home/a2 a2

# modifica o home e renomeando o diretório corrente para o novo.
usermod -m -d /home/a2 a2
usermod --move-home --home /home/a2 a2

# adiciona grupos suplementares
usermod -G audio a2
groups a2

# o grupo suplementar anterior é sobrescrito
usermod -G disk a2
groups a2

# adiciona o grupo suplementar em vez de sobrescrever
usermod -a -G audio a2
groups a2
```

### userdel
* `-r` exclui o home e mail /var/spool/mail
* `-R` uses chroot

### chage
* `-d` data da última modificação da senha
* `-W` dias antes da expiração para o usuário ser advertido
* `-l` lista de opções
* `-E` define os dias que faltam para expirar. Com -1 a conta não expira.

### passwd
* `-a` `--all` todos usuários
* `-S` informações sobre a situação do usuário

### /etc/skel

Template de arquivos usados quando os usuários são criados. São automaticamente copiados para o home do usuário.

### groupdell

Um grupo não pode ser deletado, caso seja grupo primário de algum usuário.

### groupmod
* `-n` name newname

### find
* `-uid` arquivos de um usuário mesmo que tenha sido deletado

### getent

Consulta os arquivos de configuração.

### /etc/passwd
* contém real name (comentário)
* pode ser lido por todos
* `/bin/false` é o valor de shell informado quando o usuário não pode fazer login interativo.

### /etc/shadow
* é lido apenas pelo root.
* possui a senha encriptada dos usuários, pois é uma informação sensível.

### /etc/group
* grupos do sistema com suas respectivas informações.
* pode ser lido por todos.

### /etc/gshadow
* arquivo com a senha dos grupos (os que possuem).
* somente o root tem acesso.

### /etc/login.defs
Definições do número mínimo e máximo de usuário e grupos do sistema
