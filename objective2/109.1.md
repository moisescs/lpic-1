## 109.1 Fundamentals of internet protocols

### IPv4

* notação em decimal [0-255].
* composto por 4 grupos de 8 bits totalizando 32 bits (4 * 8).
* 2^n é a fórmula para identificar quantas redes e hosts uma máscara de subrede possui.
* no caso de hosts o resultado pode ser subtraído por `-2` para descontar o endereço de `rede` e `broadcast`.
* CIDR é a notação utiliza para a máscara de subrede.

#### Classes

* `A` 0.0.0.0 - 126.255.255.255
* `B` 128.0.0.0 - 191.255.255.255
* `C` 192.0.0.0 - 223.255.255.255

#### Endereços especiais

* `0.0.0.0/0` utilizado para identificar uma rota padrão.
* `127.0.0.1/8` ou endereço de `loopback`, utilizado para testar a própria interface de rede.
* `224.0.0.0/8` multicast, broadcast para todas as redes.
* `169.254.0.0/16` link-local, ou APIPA (falha com servidor DHCP).


#### Endereços privados (LAN)

* `10.0.0.0` - `10.255.255.255`
* `172.16.0.0` - `172.32.255.255`
* `192.168.0.0` - `192.168.255.255`

### IPv6

* notação em hexadecimal [0-9a-f].
* composto por 8 grupos de 16 bits totalizando 128 bits (8 * 16).
* máscara de subrede é fixa com o valor de 128 bits.
* `::1` é a repesentação para o `localhost`.

### protocolos

* tcp orientado a conexão/three-way-handshake.
* udp não orientado a conexão.

### ifup ifdown

* habilita/desabilita as interfaces de rede.

```shell
# habilita todas interfaces configurada como auto em /etc/network/interfaces
ifup -a
```

### ifconfig

* retorna informações das interfaces `up`/`down`.
* define endereçamento ip para as interfaces.
* mais de um ip pode ser adicionado para um interface.

```shell
# informações de todas interfaces disponíveis independente se está ativa ou não
ifconfig -a

# define ip/máscara para uma interface
ifconfig eth0 192.168.1.1 netmask 255.255.255.0

# adiciona IPv6 para uma interface
ifconfig eth1 int6 add fdd6:551:b09e::/128
```

### route

* exibe a tabela de rotas.
* define gateway/rota padrão para determinada interface/rede.
* bloqueia tráfego de um determinado ip.
* FLAGs `U` rota ativa; `G` usa um gateway; `C` entrada de cache

```shell
# exibe a tabela de roteamento por ip
route -n

# adiciona bloqueio de tráfego
route add -host 192.168.1.3 reject

# adiciona gateway padrão para interface
route add default gateway 192.168.1.1 eth0

# adiciona o gateway para uma rede
route add -net 192.168.51.0 netmask 255.255.255.255 gw 192.168.51.1
```

### ip

* define gateway/rota padrão.
* o que é uma mensagem netlink? ip monitor

```shell
# define o gateway padrão para um interface
ip route change default via 192.168.1.1 dev eth0

# limpa o cache da tabela de roteamento
ip route flush cache
```

### netstat

* lista as portas de serviços que estão escutando requisições.
* lista os sockets aberto no sistema.
* lista a tabela de gateways/roteamento.

```shell
# lista sem realizar DNS lookup no ip
netstat -nr

# lista serviços de rede e sockets independente se estão ou não conectados
netstat -a
```

### host

* consulta informações de um Domain Name System

```shell
# consulta um nameserver authoritative
host -t ns
```

### dig

* consulta um Domain Name System.
* `mx` Mail Exchange. Não existe o tipo `smtp`.
* `soa` Start of Authority.
* `axfr` Zone transfers.
* `NXDOMAIN` é o status para domínio que não existe.

```shell
# SPF records are stored in the txt record type in DNS
dig -t txt

# consulta domínio de email
dig localdomain.com.br mx

# consulta start of authority
dig localdomain.com.br so

# zone transfers espeficicando o servidor
dig localdomain.com.br @192.168.1.100 axfr
```

### hostname

* retorna o nome do server ou nome de domínio.

```shell
# retorna o nome de domínio
hostname -d
```

### traceroute

* lista os roteadores por onde o pacote trafega até o destino.
* requer permissão de root.

```shell
# utiliza pacote TCP em vez de ICMP
traceroute -T
tcptraceroute

# utiliza IPv6
traceroute -6
```

### tracepath

* lista os roteadores por onde o pacote trafega até o destino.
* exibe o MTU (Max Transmission Unit)

```shell
# exibe o ip e define a porta utilizado para o pacote
tracepath -n -p 80 siscfc
```

### ping

```shell
# define a interface que vai gerar o pacote
ping -I wlp3s0 www.github.com

# define o número de pacotes enviados
ping -c 4 www.github.com
```

### ping6

* comando utilizado para enviar pacotes ICMP para IPv6.

```shell
ping6 fdd6:551:b09f::
```

### nc

* conhecido como netcat.
* cria conexões arbitrárias para qualquer porta com tcp/udp.

```shell
nc -l -p 1990
```

### getent

* lê as entradas nos arquivos de banco de dados do sistema.

```shell
# /etc/hosts
getent hosts

# /etc/group
getent group

# /etc/passwd
getent passwd
```

### /etc/hosts

* tradução local para nomes de hosts.
* um nome de domínio pode ser redirecionado.

```
127.0.0.1 localhost wwww.localhost.com.br
192.168.1.100 debia9
192.168.1.101 centos7
192.168.1.102 centos6
192.168.1.103 raspberry
```

### /etc/resolv.conf

* arquivo de configuração para definir os servidores DNS.
* `search` define o domínio.
* `nameserver` define o servidor DNS. Pode ser definido mais de uma entrada.

```
search localdomain.com.br
nameserver 192.168.1.10
nameserver 192.168.1.11
```

### /etc/nsswitch.conf

* define a ordem de acesso para cada banco de dados.

### /etc/services

* arquivo que identifica os serviços e suas respectivas portas.
* IANA é a responsável pelo registro de cada serviço.
* `0` até `1023` são as portas reservadas para o sistema.

### portas

* `ICMP` é um pacote especial que não possui vínculo com porta.

| serviço  | porta | tipo |
|---|---|---|
| LDAP SSL  | 636 | tcp |
| SSL  | 22 | tcp |
| DNS  | 53 | tcp,udp |
| SNMP client | 161 | udp |
| SNMP server | 162 | udp |
| SMTP | 25 | tcp |
| POP3 | 110 | tcp |
| IMAP | 143 | tcp |

### Domain Name System

* utiliza a porta 53 para os protocolos tcp e udp.
* UDP é utilizado para consultas.
* TCP é utilizado para zonas de transferências.
