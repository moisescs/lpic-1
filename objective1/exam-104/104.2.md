## 104.2 Maintain the integrity of filesystems

* superblock - são onde ficam os metadados do disco.
* inode são arquivos com informações sobre os arquivos, tamanho, permissões, estatística sobre acesso, etc.

### du

```shell
# verifica o tamanho dos diretórios por nível
du -h --max-depth=1 /

# verifica cada arquivo ou diretório sumarizando o tamanho
du -sh /*
```

### df

```shell
# exibe a utilização de inode no disco
df -i /dev/sdb3
# exibe o espaço utilizado e unidade legível
df -h /dev/sdb3

# exibe o tipo da partição
df -T /dev/sdb3
```

### fsck

* Verificação de erros no disco e reparação, ocorre na inicialização do sistema.
* É definida a ordem de checagem dos discos através do arquivo `/etc/fstab`.
* A checagem é feito quando o disco está desmontado.

### e2fsck

Checa partições ext e repara como `fsck`.

### mke2fs

Cria sitemas de arquivos ext2,3 e 4 como `mkfs`.

### debugfs

Acessa uma partição para realizar debug.

### dumpe2fs

```
# Traz todas as características da partição
dumpe2fs | less
Filesystem volume name:   SSD Kingston
Last mounted on:          /
Filesystem UUID:          edb47590-c58d-4651-8069-477905cfa511
Filesystem magic number:  0xEF53
Filesystem revision #:    1 (dynamic)
Filesystem features:      has_journal ext_attr resize_inode dir_index filetype needs_recovery extent 64bit flex_bg sparse_super large_file huge_file
 dir_nlink extra_isize metadata_csum
```

### tune2fs

* Define parâmetros para partições ext.

```shell
# define rótulo
tune2fs -L PGSQL-DB /dev/sdb6

# adiciona suporte a journal em partição ext2, convertendo-a para ext3
tune2fs -j /dev/sdb7

# em caso de erros na partição
tune2fs -e /dev/sdb8
```

### xfs_*

* `xfs_repair` repara uma partição corrompida ou danificada.
* `xfs_fsr` organiza os dados na partição.
* `xfs_db` entra em modo de debug na partição.
* `xfs_*` com **-V** retorna a versão da ferramenta.

```shell
# define rótulo
xfs_admin -L GIT-REPOSITORY /dev/sdb9

# melhora a organização dos dados na partição
xfs_fsr /dev/sdb5

# verifica a situação da partição sem modificar
xfs_repair -n /dev/sdb5

# zera o log do journal, utilizado quando journal está corrompido
xfs_repair -L /dev/sdb5

# define o gasto para organizar a partição e a quantidade de passos
xfs_repair -t 10 -p 5
```

### xfs_metadump xfs_info

```
xfs_metadump - copia os metadados do sistema de arquivos para um arquivo.

xfs_info /dev/sdb3
meta-data=/dev/sdb3              isize=512    agcount=4, agsize=321774 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=1 spinodes=0 rmapbt=0
         =                       reflink=0
data     =                       bsize=4096   blocks=1287093, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal               bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
```
