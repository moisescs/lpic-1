## 104.3 Control mounting and unmounting of filesystems

### mtab

`/etc/mtab` - exibe todos os dispositivos correntes montados.

### fstab

* `/etc/fstab` - referência dos pontos de montagem utilizado pelo SO na inicialização.
* Estrututura `<dev> <local> <type> <opts> <dump> <fsck>`.
* Apenas as linhas com a opção `noauto` **não** serão montadas na inicialização.
* Partição ou arquivo swap utiliza `none` para o `<local>`.

```
# root
UUID=edb47590-c58d-4651-8069-477905cfa511 /               ext4   errors=remount-ro 0       1

# swap
/swapfile   none    swap    sw      0       0

# tmp in ram
tmpfs   /tmp       tmpfs   defaults,noatime,mode=1777   0  0
tmpfs   /var/spool tmpfs   defaults,noatime,mode=1777   0  0
tmpfs   /var/tmp   tmpfs   defaults,noatime,mode=1777   0  0
```

**opções**
* users - usuários podem montar e desmontar o ponto.
* user - apenas quem montou pode desmontar.
* owner - as permissões se adequarão para o usuário que montou.
* auto/noauto - a montagem deve ocorrer de forma autmática/manual.
* exec/noexec - pode ou não ocorrer execução dentro do ponto.
* noatime - desabilita o parâmetro de tempo de acesso, melhora a performace.
* sw - swap
* rw - leitura e escrita
* ro - apenas leitura
* defaults - utiliza as opções padrões de montagem.

```shell
# monta como read-only
mount -o ro /dev/sdb2  /mnt/ro

# remonta
mount -o remount,rw /mnt/ro
touch read-only
mount -o remount,ro /mnt/ro

# monta pelo id ou label
mount UID="x123" /mnt/p1
mount LABEL="xpto" /mnt/p2

# monta uma imagem sempre em read only
mount -o loop ~/Downloads/opensuse.iso /mnt/ISO
```

**checagem**
* dump
* pass - execução da verificação do disco com fsck.

### media

### mount

```
# Quando presente no arquivo fstab, a montagem pode ocorrer de forma bidirecional, partição <-> ponto.
mount /dev/sdb2
mount /mnt/ext2-test

# Montagem manual
mount /dev/sdb2 /mnt/ext2-test

# Monta tudo que estiver definido no arquivo /etc/fstab, se não tiver o modo "noauto"
mount -a
```

### umount

```
# A desmontagem também pode ocorrer de forma bidirecional.
umount /dev/sdb2
umount /mnt/ext2-test

# Pode ocorrer do dispositivo não desmontar
umount /dev/sdb2
umount: /mnt/ext2-test: target is busy.

lsof -w /dev/sdb2
COMMAND   PID       USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
bash    14743       root  cwd    DIR   8,18     4096    2 /mnt/ext2-test
bash    17391 thiagoluis  cwd    DIR   8,18     4096    2 /mnt/ext2-test
less    17450 thiagoluis  cwd    DIR   8,18     4096    2 /mnt/ext2-test
less    17450 thiagoluis    4r   REG   8,18        0   12 /mnt/ext2-test/secondfile
lsof    17537       root  cwd    DIR   8,18     4096    2 /mnt/ext2-test
lsof    17538       root  cwd    DIR   8,18     4096    2 /mnt/ext2-test
```

### blkid

```shell
# retorna o ID da partição
blkid /dev/sda1
```

### lsblk
