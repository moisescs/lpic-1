# 103.3 Perform basic file management

## cp

```shell
# cópia recursiva, preserva os atributos
cp -pr /etc etc.bkp

# cópia recursiva, preserva os atributos e hardlinks
cp -a /etc etc.bkp

# cria um hardlink do arquivo
cp -l arquivo.txt arquivo.txt.hardlink

# não sobrescreve o conteúdo do arquivo
cp -n a b

# cria um link simbólico
cp -s a b
```

## find

```shell
# busca no mesmo nível arquivos com menos de 10MB dos últimos 7 dias
find -type f -maxdepth 1 -size -10M -mtime -7

# deleta
find -iname "*.delete" -delete

# executa um comando
find -type f -exec file {} \;

# executa um comando com confirmação
find -name "*.log" -ok bzip2 {} \;

# filtra por usuário e grupo
find -user lpi -group aprovado

# filtra pelo inode
find -inum 8444167

# filtra pela permissão
find -perm 640
```

## mkdir

```shell
# cria subdiretórios
mkdir -p a/b/c

# cria definindo a permissão
mkdir -m 777 share
```

# mv

```shell

#renomeia ou movimenta
mv a b
```

## ls

```shell
# a ocultos
# h tamanho formatado
# i inode
# l detalhes (tipo, permissão, hardlinks, etc)
# t ordena desc pela data de modificação
# r inverte a ordenação
ls -ahiltr
```

## rm
```shell
# remove recursivamente sem perguntar
rm -rf app
```

## rmdir

```shell
# remove diretórios vazios
rmdir containers
```

## touch

```shell
# atualiza o tempo do arquivo para agora ou cria senão exista
touch agora

# altera apenas a data de modificação
touch -m agora

# não cria o arquivo senão existir
touch -c arquivo.log

# define uma data para o arquivo
touch -d 19900215 nascimento.doc

# define uma data e hora para o arquivo
touch -t 201801010000.00 2018.txt
```

## tar

O `-` não é obrigatório antes das opções.

```shell
# exibe
tar -tvf file.tar

# cria
tar cf file.tar

# extrai
tar xf file.tar

# extra para
tar xf file.tar --directory=./otherdir

# gzip
tar tvzf file.tgz

# bz2
tar tvjf file.tbz

# xz
tar tvJf file.txz
```

## cpio

```shell
# cria
ls | cpio -ov > local.cpio

# extrai
cpio -iv < local.cpio
```

## dd

```shell
dd if=arquivo of=arquivo.copy
```

## ls (file globbing)

```
ls [tT]*
test  test2  test3

ls [0-9]*
20180813

ls a?
ad  ax

# inodes
ls -i

# directory
ls -ld

# reverse time
ls -ltr

# reverse size
ls -lSr

# recursive directories
a
├── b
│   └── textb
└── texta
ls -R a
a:
b  texta

a/b:
textb
```

## mkdir

```
mkdir -p /a/b/c/d
```



## touch

```
touch -[a, m, c] -t yyyymmddhhss

# access
cat test

# access modify
sed 's/e/E/g' test

# change
chmod u+r test

# update the three properties: access, modify and change
touch f0
touch -t 199002150245 f1
touch -d 9am f2
touch -d "last fortnight" f3
touch -d "yesterday 7pm" f4
touch -d "365 days ago 12:00" f5
touch -d "tomorrow 11am" f6
touch -d "25 Oct" f7

ls -l
total 0
-rw-r--r--. 1 root root 0 Aug 15 14:58 f0
-rw-r--r--. 1 root root 0 Feb 15  1990 f1
-rw-r--r--. 1 root root 0 Aug 15 09:00 f2
-rw-r--r--. 1 root root 0 Aug  1 15:01 f3
-rw-r--r--. 1 root root 0 Aug 14 19:00 f4
-rw-r--r--. 1 root root 0 Aug 15  2017 f5
-rw-r--r--. 1 root root 0 Aug 16  2018 f6
-rw-r--r--. 1 root root 0 Oct 25  2018 f7
```

## stat

```
stat test
  File: ‘test’
  Size: 38              Blocks: 8          IO Block: 4096   regular file
Device: fd00h/64768d    Inode: 8410372     Links: 1
Access: (0664/-rw-rw-r--)  Uid: (    0/    root)   Gid: (    0/    root)
Context: unconfined_u:object_r:admin_home_t:s0
Access: 2018-08-14 20:51:01.324470280 -0300
Modify: 2018-08-14 20:43:59.094561211 -0300
Change: 2018-08-14 20:50:15.708562301 -0300
 Birth: -
```

## rm mv

```
rm -i file
rm -rf ./*
mv file file-renamed
```

## cpio

```
find /etc | cpio -o > etc.cpio
cpio -iv --no-absolute-filenames < etc.cpio
```

## gzip gunzip

```
gzip file
gzip -d file.gz
gunzip file.gz
```

## bzip2 bunzip2

```
bzip2 file
bzip2 -d file.bz2
bunzip2 file.bz2
```

## xz unxz

```
xz file
xz -d file.xz
unxz file.xz
```




## dd

```
dd -b 512 if=/dev/sda of=grub.iso
dd if=/dev/vda1 of=boot.iso
umount /dev/vda1
mount -o loop boot.iso /mnt

# bkp and compress
dd if=/dev/vda1 | xz > boot.iso.xz

# restore the bkp
unxz boot.iso.xz -c | dd of=/dev/vda1
```

## find

```
find -type f -name "*.txt" -size +5[c,k,M,G]
-rw-r--r--. 1 root root 0 Aug 14 20:34 ./20180813
--w-r--r--. 1 root root 38 Aug 14 20:46 ./test2
--w-rw-r--. 1 root root 38 Aug 14 20:43 ./test3
-rw-rw-r--. 1 root root 38 Aug 14 20:43 ./test
-rw-r--r--. 1 root root 0 Aug 14 21:02 ./ax
-rw-r--r--. 1 root root 0 Aug 14 21:02 ./ad

find -maxdepth 1 -size -39c -exec ls -l {} \;
find -name "*[157]" -exec mv {} '{}.txt' \;
ls
f0  f1.txt  f2  f3  f4  f5.txt  f6  f7.txt
```

## file

```
file /etc/ld.so.conf
/etc/ld.so.conf: ASCII text
file -i /etc/ld.so.conf
/etc/ld.so.conf: text/plain; charset=us-ascii
```

## identify

```
identify *
IMG_20180724_095506.jpg JPEG 2000x588 2000x588+0+0 8-bit sRGB 334KB 0.02
0u 0:00.030
Screenshot from 2018-08-02 20-09-52.png PNG 1366x768 1366x768+0+0 8-bit
sRGB 268KB 0.000u 0:00.000
```
