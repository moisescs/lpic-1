# 103.5 Create, monitor and kill processes

## fg (foreground)

* `CTRL + Z` envia o sinal de stop `19) SIGSTOP` para o processo em execução.
* `CTRL + C` envia o sinal de interrupção `2) SIGINT` para o processo em execução.

```shell
# inicia um processo em foreground
sleep 1000

# CTRL + Z para o processo
^Z

# retoma a execução em foreground
fg %1
```

## bg (background)

```shell
# inicia um processo em background
sleep 1000 &

# para o processo 1860 em background
kill -19 1860

# retoma o processo 1860 em background
bg %1
```

```
(while sleep 2; do date; done)
Thu Aug 16 15:34:52 -03 2018
Thu Aug 16 15:34:54 -03 2018
Thu Aug 16 15:34:56 -03 2018
^Z
[1]+  Stopped                 ( while sleep 2; do
    date;
done )
fg %1
( while sleep 2; do
    date;
done )
Thu Aug 16 15:35:04 -03 2018
Thu Aug 16 15:35:06 -03 2018
```

## bg (background)

```
sleep 1000
^Z
[1]+  Stopped                 sleep 1000
bg %1
[1]+ sleep 1000 &
jobs
[1]+  Running                 sleep 1000 &
```

## jobs

* `ps -l` visualiza os jobs com mais detalhes.
* `ps --forest` visualiza a hierarquia dos jobs.

```shell
# lista os jobs e a situação
jobs
[3]+  Stopped                 sleep 1000
[4]   Running                 sleep 1001 &
[5]-  Running                 sleep 1002 &

# lista os jobs mostrando os respectivos PIDs
jobs -l
[3]+  2300 Stopped                 sleep 1000
[4]   2304 Running                 sleep 1001 &
[5]-  2307 Running                 sleep 1002 &
```

## pgrep

```shell
# filtra os processos a partir do comando
pgrep -a sleep
```

## pkill e killall

* `killall -9 -u user` força a finalização dos processos de um usuário.
* `killall -g user` finaliza os processos de um grupo.

```shell
# finaliza todos processos que contenha sleep no comando
pkill sleep
# finaliza todos processos que contenha sleep no comando
killall sleep
```


## pstree

```
pstree -ap $$
bash,1243
  ├─pstree,2319 -ap 1243
  ├─sleep,2300 1000
  ├─sleep,2304 1001
  └─sleep,2307 1002
```

## ps

```shell
# primeiro processo
ps -p 1

# todos os processos personalizando as colunas. As opções -e -A são a mesma coisa
ps -eo ppid,pid,user,stat,ni,comm

# todos os processos de um usuário
ps -fu aprovado

# BSD syntax
ps axu

# formato padrão
ps -ef

# melhor formato: ppid, pid, stat, user, comm, etc
ps -ly

# process tree
ps --forest
ps -jH
ps jf
```

## nohup

* ignora sinais sighup e escreve `stdout` e `stderr` em nohup.out.

```
sleep 1000 &
[1] 2336
kill -1 2336
jobs
[1]+  Hangup                  sleep 1000

nohup sleep 1000 &
[1] 2337
kill -1 2337
jobs
[1]+  Running                 nohup sleep 1000 &
```

## top

* t,m,l - modo de visualização para cpu, memória e load average respectivamente.
* b - destaca os processos com status running.
* x - destaca a coluna com status running.
* y - destaca a linha com status running.
* shift <> - movimenta a seleção da coluna ordenada para esquerda ou direta.
* shift + r - inverte a ordenação.
* o - define filtros baseado no nome das colunas.

## uptime

```
uptime
 15:06:46 up 4 min,  1 user,  load average: 0.00, 0.03, 0.02
```

## free

* -b bytes
* -k kilobytes
* -m megabytes
* -t sum ram + swap
* -w segrega buffer e cache

```
free -htw
              total        used        free      shared     buffers       cache   available
Mem:           991M        105M        760M        6.7M        2.1M        123M        738M
Swap:          923M          0B        923M
Total:         1.9G        105M        1.6G
```

## screen

Cria uma subsessão dentro da sessão.

* `CTRL + a` c - cria uma sessão.
* `CTRL + a` n - vai para a próxima sessão
* `CTRL + a` p - vai para a sessão anterior
